<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NeoGPT</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
  body { background-color: #121212; color: #e0e0e0; display: flex; height: 100vh; overflow: hidden; }
  a { color: #82b1ff; text-decoration: none; }

  #history { width: 35%; background-color: #1e1e1e; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
  .message { padding: 10px 15px; border-radius: 10px; max-width: 90%; word-wrap: break-word; }
  .user { background-color: #2a2a2a; align-self: flex-end; color: #ffffff; }
  .bot { background-color: #333333; align-self: flex-start; color: #82b1ff; }
  .bot img { max-width: 100%; border-radius: 10px; margin-top: 5px; }

  #inputPanel { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; background-color: #181818; padding: 20px; }
  #promptInput { width: 100%; padding: 15px; border-radius: 10px; border: none; background-color: #2a2a2a; color: #ffffff; font-size: 16px; }
  #sendBtn { margin-top: 10px; padding: 12px 20px; border: none; border-radius: 10px; background-color: #82b1ff; color: #121212; font-weight: bold; cursor: pointer; transition: 0.2s; }
  #sendBtn:hover { background-color: #4f83cc; }

  #history::-webkit-scrollbar { width: 6px; }
  #history::-webkit-scrollbar-thumb { background-color: #555; border-radius: 3px; }
</style>
</head>
<body>

<div id="history"></div>

<div id="inputPanel">
  <input type="text" id="promptInput" placeholder="Ask NeoGPT something..." autofocus>
  <button id="sendBtn">Send</button>
</div>

<script>
const historyDiv = document.getElementById('history');
const promptInput = document.getElementById('promptInput');
const sendBtn = document.getElementById('sendBtn');

const backendURL = "https://CreatorOfNeoGPT.pythonanywhere.com";

// Load history from localStorage
let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];
chatHistory.forEach(msg => addMessage(msg.text, msg.sender, msg.isImage, false));

// Append message to history
function addMessage(text, sender='user', isImage=false, save=true) {
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message ' + sender;
    if(isImage){
        const img = document.createElement('img');
        img.src = text;
        msgDiv.appendChild(img);
    } else {
        msgDiv.textContent = text;
    }
    historyDiv.appendChild(msgDiv);
    historyDiv.scrollTop = historyDiv.scrollHeight;

    if(save){
        chatHistory.push({text, sender, isImage});
        localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
    }
}

// Send prompt to backend
async function sendPrompt() {
    const prompt = promptInput.value.trim();
    if(!prompt) return;
    addMessage(prompt, 'user');
    promptInput.value = '';

    try {
        // Chat response
        const chatResponse = await fetch(`${backendURL}/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
        });
        const chatData = await chatResponse.json();
        if(chatData.response) addMessage(chatData.response, 'bot');

        // Image generation
        const imgResponse = await fetch(`${backendURL}/image`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
        });
        const imgData = await imgResponse.json();
        if(imgData && imgData[0] && imgData[0].generated_image_url){
            addMessage(imgData[0].generated_image_url, 'bot', true);
        }
    } catch(err){
        addMessage("Error: Could not connect to backend.", 'bot');
        console.error(err);
    }
}

// Event listeners
sendBtn.addEventListener('click', sendPrompt);
promptInput.addEventListener('keypress', e => { if(e.key === 'Enter') sendPrompt(); });
</script>

</body>
</html>
